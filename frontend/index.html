<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Enron Spam Classifier</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f4f6;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .card {
      background: white;
      padding: 30px;
      width: 520px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    textarea {
      width: 100%;
      height: 140px;
      padding: 10px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #ccc;
      resize: none;
    }

    button {
      width: 100%;
      margin-top: 15px;
      padding: 12px;
      font-size: 16px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background: #1d4ed8;
    }

    .result {
      margin-top: 20px;
      padding: 15px;
      background: #f8fafc;
      border-radius: 8px;
      display: none;
    }

    .spam {
      color: #dc2626;
      font-weight: bold;
    }

    .ham {
      color: #16a34a;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>Enron Spam Classifier</h1>

    <textarea id="emailText" placeholder="Enter email text here..."></textarea>

    <button onclick="predict()">Predict</button>

    <div id="result" class="result">
      <div>
        Prediction:
        <span id="label"></span>
      </div>

      <div>
        Probability:
        <span id="prob"></span> %
      </div>

      <!-- Confidence Bar -->
      <div style="margin-top:15px;">
        <div style="font-size:14px; margin-bottom:5px;">
          Confidence Level
        </div>

        <div style="background:#e5e7eb; border-radius:8px; overflow:hidden; height:14px;">
          <div id="confidence-bar"
               style="height:100%; width:0%; transition:width 0.6s ease;">
          </div>
        </div>
      </div>

      <div style="margin-top:10px; font-size:13px; color:#6b7280;">
        Model: BiLSTM | Dataset: Enron
      </div>
    </div>
  </div>

  <script>
    async function predict() {
      const text = document.getElementById("emailText").value;
      if (!text.trim()) return;

      try {
        const response = await fetch("http://127.0.0.1:5000/predict", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ text: text })
        });

        if (!response.ok) {
          throw new Error("Server error");
        }

        const data = await response.json();
        console.log("Response:", data);

        const probPercent = (data.probability * 100).toFixed(2);

        document.getElementById("result").style.display = "block";
        document.getElementById("prob").innerText = probPercent;

        const labelSpan = document.getElementById("label");
        const confidenceBar = document.getElementById("confidence-bar");

        if (data.label === "Spam") {
          labelSpan.innerText = "Spam";
          labelSpan.className = "spam";
          confidenceBar.style.background =
            probPercent > 80 ? "#dc2626" : "#f97316";
        } else {
          labelSpan.innerText = "Ham";
          labelSpan.className = "ham";
          confidenceBar.style.background =
            probPercent > 80 ? "#16a34a" : "#22c55e";
        }

        confidenceBar.style.width = probPercent + "%";

      } catch (error) {
        console.error("Prediction error:", error);
        alert("Prediction failed. Check backend.");
      }
    }
  </script>
</body>
</html>
